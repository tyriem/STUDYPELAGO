{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import React from 'react'\n\nvar W3CWebSocket = require('websocket').w3cwebsocket;\n\nclass WebSocket extends React.Component {constructor(props) {\n  super(props);\n    this.state = {\n      ws: new W3CWebSocket(this.props.url),\n      attempts: 1\n    };\n    this.sendMessage = this.sendMessage.bind(this);\n    this.setupWebsocket = this.setupWebsocket.bind(this);\n  }\n\n  logging(logline) {\n    if (this.props.debug === true) {\n      console.log(logline);\n    }\n  }\n\n  generateInterval(k) {\n    if (this.props.reconnectIntervalInMilliSeconds > 0) {\n      return this.props.reconnectIntervalInMilliSeconds;\n    }\n    return Math.min(30, Math.pow(2, k) - 1) * 1000;\n  }\n\n  setupWebsocket() {\n    let websocket = this.state.ws;\n\n    websocket.onopen = () => {\n      this.logging('Websocket connected...');\n      if (typeof this.props.onOpen === 'function') this.props.onOpen();\n    };\n\n    websocket.onerror = e => {\n      if (typeof this.props.onError === 'function') this.props.onError(e);\n    };\n\n    websocket.onmessage = evt => {\n      this.props.onMessage(evt.data);\n    };\n\n    this.shouldReconnect = this.props.reconnect;\n    websocket.onclose = evt => {\n      this.logging(\n        `Websocket disconnected,the reason: ${evt.reason},the code: ${evt.code}`\n      );\n      if (typeof this.props.onClose === 'function')\n        this.props.onClose(evt.code, evt.reason);\n      if (this.shouldReconnect) {\n        let time = this.generateInterval(this.state.attempts);\n        this.timeoutID = setTimeout(() => {\n          this.setState({ attempts: this.state.attempts + 1 });\n          this.setState({ ws: new W3CWebSocket(this.props.url) });\n          this.setupWebsocket();\n        }, time);\n      }\n    };\n  }\n\n  componentDidMount() {\n    const { childRef } = this.props;\n    childRef && childRef(this);\n\n    this.setupWebsocket();\n  }\n\n  componentWillUnmount() {\n    const { childRef } = this.props;\n    childRef && childRef(undefined);\n\n    this.shouldReconnect = false;\n    clearTimeout(this.timeoutID);\n\n    let websocket = this.state.ws;\n    websocket.close();\n  }\n\n  sendMessage(message) {\n    let websocket = this.state.ws;\n    websocket.send(message);\n  }\n\n  render() {\n    return <div></div>;\n  }\n}\n\nexport {\n  WebSocket\n}"],"names":["W3CWebSocket","require","w3cwebsocket","WebSocket","props","state","ws","url","attempts","sendMessage","bind","setupWebsocket","logging","logline","debug","console","log","generateInterval","k","reconnectIntervalInMilliSeconds","Math","min","pow","websocket","onopen","onOpen","onerror","e","onError","onmessage","evt","onMessage","data","shouldReconnect","reconnect","onclose","reason","code","onClose","time","timeoutID","setTimeout","setState","componentDidMount","childRef","componentWillUnmount","undefined","clearTimeout","close","message","send","render","React","Component"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAIA,YAAY,GAAGC,OAAO,CAAC,WAAD,CAAP,CAAqBC,YAAxC;;IAEMC;;;AAAmC,qBAAYC,KAAZ,EAAmB;AAAA;;AAC1D,wCAAMA,KAAN;AACE,UAAKC,KAAL,GAAa;AACXC,MAAAA,EAAE,EAAE,IAAIN,YAAJ,CAAiB,MAAKI,KAAL,CAAWG,GAA5B,CADO;AAEXC,MAAAA,QAAQ,EAAE;AAFC,KAAb;AAIA,UAAKC,WAAL,GAAmB,MAAKA,WAAL,CAAiBC,IAAjB,+BAAnB;AACA,UAAKC,cAAL,GAAsB,MAAKA,cAAL,CAAoBD,IAApB,+BAAtB;AAPwD;AAQzD;;;;SAEDE,UAAA,iBAAQC,OAAR,EAAiB;AACf,QAAI,KAAKT,KAAL,CAAWU,KAAX,KAAqB,IAAzB,EAA+B;AAC7BC,MAAAA,OAAO,CAACC,GAAR,CAAYH,OAAZ;AACD;AACF;;SAEDI,mBAAA,0BAAiBC,CAAjB,EAAoB;AAClB,QAAI,KAAKd,KAAL,CAAWe,+BAAX,GAA6C,CAAjD,EAAoD;AAClD,aAAO,KAAKf,KAAL,CAAWe,+BAAlB;AACD;;AACD,WAAOC,IAAI,CAACC,GAAL,CAAS,EAAT,EAAaD,IAAI,CAACE,GAAL,CAAS,CAAT,EAAYJ,CAAZ,IAAiB,CAA9B,IAAmC,IAA1C;AACD;;SAEDP,iBAAA,0BAAiB;AAAA;;AACf,QAAIY,SAAS,GAAG,KAAKlB,KAAL,CAAWC,EAA3B;;AAEAiB,IAAAA,SAAS,CAACC,MAAV,GAAmB,YAAM;AACvB,MAAA,MAAI,CAACZ,OAAL,CAAa,wBAAb;;AACA,UAAI,OAAO,MAAI,CAACR,KAAL,CAAWqB,MAAlB,KAA6B,UAAjC,EAA6C,MAAI,CAACrB,KAAL,CAAWqB,MAAX;AAC9C,KAHD;;AAKAF,IAAAA,SAAS,CAACG,OAAV,GAAoB,UAAAC,CAAC,EAAI;AACvB,UAAI,OAAO,MAAI,CAACvB,KAAL,CAAWwB,OAAlB,KAA8B,UAAlC,EAA8C,MAAI,CAACxB,KAAL,CAAWwB,OAAX,CAAmBD,CAAnB;AAC/C,KAFD;;AAIAJ,IAAAA,SAAS,CAACM,SAAV,GAAsB,UAAAC,GAAG,EAAI;AAC3B,MAAA,MAAI,CAAC1B,KAAL,CAAW2B,SAAX,CAAqBD,GAAG,CAACE,IAAzB;AACD,KAFD;;AAIA,SAAKC,eAAL,GAAuB,KAAK7B,KAAL,CAAW8B,SAAlC;;AACAX,IAAAA,SAAS,CAACY,OAAV,GAAoB,UAAAL,GAAG,EAAI;AACzB,MAAA,MAAI,CAAClB,OAAL,yCACwCkB,GAAG,CAACM,MAD5C,mBACgEN,GAAG,CAACO,IADpE;;AAGA,UAAI,OAAO,MAAI,CAACjC,KAAL,CAAWkC,OAAlB,KAA8B,UAAlC,EACE,MAAI,CAAClC,KAAL,CAAWkC,OAAX,CAAmBR,GAAG,CAACO,IAAvB,EAA6BP,GAAG,CAACM,MAAjC;;AACF,UAAI,MAAI,CAACH,eAAT,EAA0B;AACxB,YAAIM,IAAI,GAAG,MAAI,CAACtB,gBAAL,CAAsB,MAAI,CAACZ,KAAL,CAAWG,QAAjC,CAAX;;AACA,QAAA,MAAI,CAACgC,SAAL,GAAiBC,UAAU,CAAC,YAAM;AAChC,UAAA,MAAI,CAACC,QAAL,CAAc;AAAElC,YAAAA,QAAQ,EAAE,MAAI,CAACH,KAAL,CAAWG,QAAX,GAAsB;AAAlC,WAAd;;AACA,UAAA,MAAI,CAACkC,QAAL,CAAc;AAAEpC,YAAAA,EAAE,EAAE,IAAIN,YAAJ,CAAiB,MAAI,CAACI,KAAL,CAAWG,GAA5B;AAAN,WAAd;;AACA,UAAA,MAAI,CAACI,cAAL;AACD,SAJ0B,EAIxB4B,IAJwB,CAA3B;AAKD;AACF,KAdD;AAeD;;SAEDI,oBAAA,6BAAoB;AAAA,QACVC,QADU,GACG,KAAKxC,KADR,CACVwC,QADU;AAElBA,IAAAA,QAAQ,IAAIA,QAAQ,CAAC,IAAD,CAApB;AAEA,SAAKjC,cAAL;AACD;;SAEDkC,uBAAA,gCAAuB;AAAA,QACbD,QADa,GACA,KAAKxC,KADL,CACbwC,QADa;AAErBA,IAAAA,QAAQ,IAAIA,QAAQ,CAACE,SAAD,CAApB;AAEA,SAAKb,eAAL,GAAuB,KAAvB;AACAc,IAAAA,YAAY,CAAC,KAAKP,SAAN,CAAZ;AAEA,QAAIjB,SAAS,GAAG,KAAKlB,KAAL,CAAWC,EAA3B;AACAiB,IAAAA,SAAS,CAACyB,KAAV;AACD;;SAEDvC,cAAA,qBAAYwC,OAAZ,EAAqB;AACnB,QAAI1B,SAAS,GAAG,KAAKlB,KAAL,CAAWC,EAA3B;AACAiB,IAAAA,SAAS,CAAC2B,IAAV,CAAeD,OAAf;AACD;;SAEDE,SAAA,kBAAS;AACP,wBAAO,gCAAP;AACD;;;EAlFqBC,KAAK,CAACC;;;;"}